# 智增增平台支持指南

本文档提供了如何在角色化大语言模型知识库管理系统中使用智增增平台API的详细说明。

## 什么是智增增平台

智增增是一个提供OpenAI API代理服务的平台，用户可以通过智增增平台购买API密钥，以更经济的方式调用OpenAI的API服务。

## 系统修改内容

为了支持智增增平台，我们对系统进行了以下修改：

1. **OpenAI客户端增强**：
   - 添加了`base_url`参数支持，用于指定API基础URL
   - 支持从环境变量`OPENAI_BASE_URL`读取基础URL
   - 修改了LangChain客户端配置，支持自定义API基础URL

2. **环境变量配置**：
   - 添加了`.env.example`文件，包含智增增平台配置示例
   - 添加了对`OPENAI_BASE_URL`环境变量的支持

## 配置步骤

### 1. 获取智增增API密钥

1. 注册并登录智增增平台
2. 购买API额度
3. 获取API密钥

### 2. 配置环境变量

创建`.env`文件，添加以下内容：

```
# OpenAI API配置
OPENAI_API_KEY=your_zhizengzeng_api_key_here
OPENAI_BASE_URL=https://api.zhizengzeng.com/v1  # 智增增平台API基础URL

# 其他配置
DATABASE_URL=sqlite:///./character_llm.db
DEBUG=false
CORS_ORIGINS=["http://localhost:3000","http://localhost:5173","http://your_domain.com"]
CHROMA_PERSIST_DIRECTORY=./chroma_db
```

### 3. 验证配置

启动系统后，可以通过以下方式验证智增增平台配置是否生效：

1. 检查日志，确认API请求发送到智增增平台
2. 尝试生成角色或进行对话，确认功能正常
3. 在智增增平台查看API调用记录和余额

## 常见问题

### API调用失败

如果遇到API调用失败，请检查：

1. API密钥是否正确
2. 基础URL是否正确
3. 智增增平台账户余额是否充足
4. 智增增平台是否支持您尝试使用的模型

### 模型兼容性

智增增平台可能不支持所有OpenAI模型，或者模型名称可能有所不同。如果遇到模型不可用的问题，请：

1. 查看智增增平台支持的模型列表
2. 修改`app/core/llm/openai_client.py`中的默认模型名称
3. 在环境变量中指定支持的模型名称

### 响应格式差异

如果智增增平台的响应格式与官方OpenAI API有差异，可能需要调整代码以适应这些差异：

1. 检查响应解析逻辑
2. 根据需要调整`generate_response`和`generate_structured_response`方法

## 性能优化

使用智增增平台时，可以考虑以下性能优化措施：

1. **批量请求**：尽可能合并多个请求，减少API调用次数
2. **缓存结果**：对于重复或相似的请求，实现结果缓存
3. **降低模型复杂度**：在不影响质量的情况下，选择更轻量级的模型
4. **优化提示词**：精简提示词，减少token消耗

## 成本控制

为了控制API调用成本，可以：

1. 实现请求限流机制
2. 设置每日API调用配额
3. 监控API使用情况，及时发现异常
4. 优化提示词和参数，减少token消耗

## 更新与维护

智增增平台的API可能会随时更新，为了保持系统兼容性：

1. 定期检查智增增平台的API文档
2. 关注智增增平台的更新公告
3. 测试系统与最新API的兼容性
4. 及时更新系统代码以适应API变化

## 结论

通过以上配置，您可以成功将角色化大语言模型知识库管理系统与智增增平台集成，享受更经济的API调用服务。如果遇到任何问题，请参考智增增平台的官方文档或联系智增增平台的客户支持。
